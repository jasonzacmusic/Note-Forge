# Firebase Deployment Guide - Musical Note Generator

This guide will walk you through deploying your Musical Note Generator application to Firebase Hosting with Cloud Functions.

## Prerequisites

### 1. Install Firebase CLI

```bash
npm install -g firebase-tools
```

### 2. Login to Firebase

```bash
firebase login
```

This will open a browser window for you to authenticate with your Google account.

## Initial Setup

### 1. Create a Firebase Project

1. Go to [Firebase Console](https://console.firebase.google.com)
2. Click **"Add project"**
3. Enter project name (e.g., `musical-note-generator`)
4. Disable Google Analytics (optional)
5. Click **"Create project"**
6. Wait for project creation to complete

### 2. Configure Your Project

Update the `.firebaserc` file with your Firebase project ID:

```json
{
  "projects": {
    "default": "your-actual-project-id"
  }
}
```

Replace `your-actual-project-id` with the project ID from Firebase Console.

### 3. Initialize Firebase in Your Project

You can skip this step as the configuration files are already created. But if you need to reinitialize:

```bash
firebase init
```

Select:
- **Hosting**: Configure files for Firebase Hosting
- **Functions**: Configure a Cloud Functions directory

Use these settings:
- Functions language: **JavaScript**
- Use ESLint: **No** (or Yes if you prefer)
- Install dependencies: **Yes**
- Public directory: **dist**
- Single-page app: **Yes**
- Overwrite index.html: **No**

## Project Structure

Your Firebase files:

```
.
â”œâ”€â”€ firebase.json          # Firebase configuration
â”œâ”€â”€ .firebaserc           # Firebase project settings
â”œâ”€â”€ functions/            # Cloud Functions directory
â”‚   â”œâ”€â”€ index.js         # Express API wrapped as Cloud Function
â”‚   â”œâ”€â”€ package.json     # Functions dependencies
â”‚   â””â”€â”€ .gitignore       # Functions gitignore
â”œâ”€â”€ dist/                # Built frontend (generated by Vite)
â””â”€â”€ DEPLOYMENT.md        # This file
```

## Deployment Commands

### Build the Application

Before deploying, always build your Vite frontend:

```bash
npm run build
```

This creates optimized production files in the `dist/` directory.

### Deploy Everything

Deploy both hosting and functions:

```bash
npm run build && firebase deploy
```

### Deploy Only Hosting

If you only changed the frontend:

```bash
npm run build && firebase deploy --only hosting
```

### Deploy Only Functions

If you only changed the backend API:

```bash
firebase deploy --only functions
```

### Test Locally Before Deploying

Test your app with Firebase emulators:

```bash
npm run build && firebase serve
```

This serves your app locally at `http://localhost:5000`

## Adding API Routes

To add backend API routes, edit `functions/index.js`:

```javascript
// Example GET endpoint
app.get('/api/notes', (req, res) => {
  res.json({ notes: ['C', 'D', 'E', 'F', 'G', 'A', 'B'] });
});

// Example POST endpoint
app.post('/api/generate', (req, res) => {
  const { count } = req.body;
  // Your logic here
  res.json({ success: true, count });
});
```

All API routes are automatically prefixed with `/api/` and routed through Cloud Functions.

## Environment Variables

### Frontend Environment Variables

Create `.env` file in the project root:

```env
VITE_API_URL=https://your-project-id.web.app
VITE_FIREBASE_PROJECT_ID=your-project-id
```

Access in your React code:

```javascript
const apiUrl = import.meta.env.VITE_API_URL;
```

### Backend Environment Variables (Cloud Functions)

Set environment variables for functions:

```bash
firebase functions:config:set api.key="your-secret-key"
firebase functions:config:set app.environment="production"
```

Access in `functions/index.js`:

```javascript
import functions from 'firebase-functions';

const apiKey = functions.config().api.key;
```

## Your Live URLs

After successful deployment:

- **Hosting URL**: `https://your-project-id.web.app`
- **Alternative URL**: `https://your-project-id.firebaseapp.com`
- **API Endpoint**: `https://your-project-id.web.app/api/health`

### Custom Domain

To add a custom domain:

1. Go to Firebase Console â†’ Hosting
2. Click **"Add custom domain"**
3. Enter your domain name
4. Follow DNS configuration instructions
5. Wait for SSL certificate provisioning (can take up to 24 hours)

## Deployment Workflow

### Recommended Workflow

1. **Make changes** to your code
2. **Test locally**: `npm run dev`
3. **Build**: `npm run build`
4. **Test production build**: `firebase serve`
5. **Deploy**: `firebase deploy`
6. **Verify**: Visit your live URL

### Quick Deploy Script

Add this to your terminal aliases or create a deploy script:

```bash
#!/bin/bash
# deploy.sh
npm run build && firebase deploy && echo "âœ… Deployed successfully!"
```

Make it executable:
```bash
chmod +x deploy.sh
```

Run it:
```bash
./deploy.sh
```

## Troubleshooting

### Issue: 404 Error on Page Refresh

**Solution**: This is already configured in `firebase.json`:

```json
"rewrites": [
  {
    "source": "**",
    "destination": "/index.html"
  }
]
```

### Issue: API Calls Fail

**Checklist**:
1. âœ… Functions deployed successfully
2. âœ… API rewrite rule in `firebase.json` is before the catch-all
3. âœ… CORS is enabled in `functions/index.js`
4. âœ… Check Cloud Functions logs: `firebase functions:log`

### Issue: Build Fails

```bash
# Clear node_modules and reinstall
rm -rf node_modules
npm install

# Clear Vite cache
rm -rf node_modules/.vite
npm run build
```

### Issue: Functions Won't Deploy

```bash
# Navigate to functions directory
cd functions

# Install dependencies
npm install

# Return to root and deploy
cd ..
firebase deploy --only functions
```

## View Logs

### Hosting Logs

```bash
firebase hosting:channel:list
```

### Functions Logs

```bash
firebase functions:log
```

Or view in Firebase Console â†’ Functions â†’ Logs

## Monitoring and Analytics

1. **Firebase Console**: View deployment history, traffic, and errors
2. **Performance Monitoring**: Enable in Firebase Console â†’ Performance
3. **Analytics**: Enable Google Analytics if desired

## Cost Considerations

### Firebase Free Tier (Spark Plan)

**Hosting**:
- 10 GB storage
- 360 MB/day transfer
- Free SSL certificates

**Cloud Functions**:
- 2M invocations/month
- 400,000 GB-seconds
- 200,000 GHz-seconds

### Upgrade if Needed

For production apps with high traffic, consider the Blaze (pay-as-you-go) plan.

## CI/CD with GitHub Actions

Create `.github/workflows/firebase-deploy.yml`:

```yaml
name: Deploy to Firebase

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Install dependencies
        run: npm ci
      
      - name: Build
        run: npm run build
      
      - name: Deploy to Firebase
        uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          repoToken: '${{ secrets.GITHUB_TOKEN }}'
          firebaseServiceAccount: '${{ secrets.FIREBASE_SERVICE_ACCOUNT }}'
          channelId: live
          projectId: your-project-id
```

To set up:
1. Generate a service account in Firebase Console
2. Add it as `FIREBASE_SERVICE_ACCOUNT` secret in GitHub repo settings

## Rollback

If you need to rollback to a previous version:

```bash
# List hosting versions
firebase hosting:channel:list

# Rollback (through Firebase Console)
```

Go to Firebase Console â†’ Hosting â†’ Release history â†’ Choose version â†’ Rollback

## Support

- **Firebase Documentation**: https://firebase.google.com/docs
- **Firebase Community**: https://firebase.community
- **Stack Overflow**: Tag your questions with `firebase`

## Quick Reference

```bash
# Build
npm run build

# Deploy all
firebase deploy

# Deploy hosting only
firebase deploy --only hosting

# Deploy functions only
firebase deploy --only functions

# Test locally
firebase serve

# View functions logs
firebase functions:log

# Open Firebase Console
firebase open
```

---

**Ready to deploy?** Run: `npm run build && firebase deploy`

Your Musical Note Generator will be live in minutes! ðŸŽµ
